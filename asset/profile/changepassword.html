<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/webbanhang/asset/html/style.css">
    <link rel="stylesheet" href="/webbanhang/asset/html/app.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>
<style>
    #changePass{
        margin: auto;
        width: 400px;
        height: 250px;
        background-color: #fff;
        box-shadow: 0px 0px 6px 0px rgb(0 0 0/10%);
    }
    #changePass > input{
        width: 80%;
        margin-top:20px ;
    }
    .btn-form{
        margin-top: 24px !important;
        text-transform: uppercase !important;
        font-size: 15px;
        padding: 7px 16px;
        line-height: 20px;
        margin-top: 10px;
        margin-bottom: 10px;
        display: inline-block;
        background: #000;
        color: #fff;
        border: 0;
        border-radius: 0;
    }
    .box-notify{
    background: rgba(0,0,0,0.5);
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 1;
    display: none;
}
.notify-content{
    margin: auto;
    width: 400px;
    height: 250px;
    background-color:#fff;
    border-radius: 20px;
}
.notify-content h4{
    text-align:center;
}
.notify-content i {
    padding: 30px;
    border-radius: 99px;
    color: rgb(40, 216, 40);
    border: 2px solid rgb(40, 216, 40);
    font-size: 30px;
}
.notify-content span{
    margin-top: 20px;
    border-radius: 10px;
    background-color: #000;
    padding: 15px 30px;
    color: #fff;
    cursor: pointer;
}
.error-color{
    color: rgb(255, 171, 15) !important;
    border: 2px solid rgb(255, 171, 15) !important;
    border-radius : 100% !important;
}
</style>
<body>
    <div class="box-logo w-100 d-flex align-items-center">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-4">
                    <div class="change-type-clothes d-flex align-items-center">
                        <div id="man-btn" class="change-type-clothes-btn align-self-center current-btn-change">
                            <button id="btn-clothes-man" class="text-center">Nam</button>
                        </div>
                        <div id="woman-btn" class="change-type-clothes-btn align-self-center">
                            <button id="btn-clothes-woman" class="text-center">Nữ</button>
                        </div>
                    </div>
                </div>
                <div class="box-logo-img col-md-4 text-center">
                    <a href="C:\xampp\htdocs\webbanhang\index.html" class="title-logo">
                        <img src="https://scontent.fhan2-3.fna.fbcdn.net/v/t1.15752-9/340637288_872794611236368_5042855998988836652_n.png?_nc_cat=102&ccb=1-7&_nc_sid=ae9488&_nc_ohc=tiGZgJ4MsMUAX-y4Y5H&_nc_ht=scontent.fhan2-3.fna&oh=03_AdSHKDN3xBb-Jugz63yCcp8Mm7F0qtKCV1y9O0j0jDvM1g&oe=6460C638" alt="" class="img-logo">
                    </a>
                </div>
                <div class="col-md-4 text-right ">
                    <div class="header-box-user-cart d-flex justify-content-end align-items-center">
                        <div class="box-user-cart-item d-flex align-items-center justify-content-center">
                            <a style="text-decoration: none; color: #000;" class="d-flex align-items-center" href="/webbanhang  /asset/profile/me.html">
                                <img class="avt" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBwgHBgkIBwgKCgkLDRYPDQwMDRsUFRAWIB0iIiAdHx8kKDQsJCYxJx8fLT0tMTU3Ojo6Iys/RD84QzQ5OjcBCgoKDQwNGg8PGjclHyU3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3N//AABEIAIEAfgMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAABAUCAwYBB//EADEQAAIBAwIEAwYGAwAAAAAAAAABAgMEEQUhEjFBYTJRcRMiI1KBkhQVQpGhsTRDcv/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAwDAQACEQMRAD8A+iAA0gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE3SqCrXWZeGCy+4G6y0vjiqly2k+UFt+5ZQsreCSjRh9Vk34PSVUadjbTWHRgvRYKu+010E6lH3odV1RenjSaaa5gcmCRfUfYXU4Ll4l6EcqAAAAAAAAAAAFxoUV7OrLq5YKct9CkuCrHrlMmqtgAQAABS65H4tKXVporCz1yea9KHyrJWGsQAAAAAAAAAAHpvsLj8NcKcvC9pEcAdZFppNcnyPSgsdRlbr2dXMqfTziW1O+tppYrRXq8EipJhUnGnBym8JLLI9bULanHLqp9o7sqL6+ndPhj7tJdM8/UkGm5rO4rzqN7N7LsagDSAAAAAAAAABJs7Sd1PC2gvFICOt3hcyRTsbqosxpPHfYu7azo28fhxXF1k+bJGNyVVB+WXXWEPvH5XdfJD7zoAKOfWl3S/TD7zx6ZdJeCL9JHQgUczVs7mkszoyx5rc0djrMdyLd2NG4XvRUZ/MkKOdBtubepbVOCovR9GaioAAAAANlClKvWjTh+p8/I6ShThRpKnBYSKzRKS+JVfPPCi0Jqs89hnsYfUEGeRkwyMgZ5QyYZAGeewyYb+YA13VvC5ounLn0fkznJxcJyjLmnhnT5KbWYcNwprlOP8lwV4AKgAALnScK02+Zk3JA0mS/DSjndSZM3AzTPfqa9xuBmMmG43AzyMmG43AzyMmG43AyyV+s706T68T/AKJxX6vNcFKHXLYFYAAAAAsdI/2FkAAAAAAAAAAAAB8ip1X/ACF/yABCAAH/2Q==" alt="" srcset="">
                                <p class="name-user align-self-center">Test</p>
                            </a>
                        </div>
                        <div id="open-modal" class="box-user-cart-item align-self-center">
                            <i class="fa-solid fa-bag-shopping"></i> <span class="amount">0</span>
                        </div>
                    </div>
                </div>
                
            </div>
            
        </div>
    </div>
    <div class="shop-navbar w-100 d-flex">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-10 col-md-12">
                    <ul class="navbar-list">
                        <li class="navbar-item"><a href="#" class="navbar-item-link">trang chủ</a></li>
                        <li class="navbar-item"><a href="#" class="navbar-item-link">tin tức</a></li>
                        <li class="navbar-item relative show-product"><a href="#" class="navbar-item-link">sản phẩm <i class="fa-solid fa-chevron-down"></i></a>
                            <div class="box-nav-product">
                                <ul class="nav-product-list">
                                    <li class="nav-product-item show-tee"><a href="#" class="nav-product-link">Áo nam <i class="fa-solid fa-angle-right"></i></a>
                                        <div class="box-tee">
                                            <ul class="product-list">
                                                <li class="sub-product-item"><a href="#" class="product-link">Hoodie</a></li>
                                                <li class="sub-product-item"><a href="#" class="product-link">Sơ mi</a></li>
                                                <li class="sub-product-item"><a href="#" class="product-link">Phông</a></li>
                                                <li class="sub-product-item"><a href="#" class="product-link">Khoác</a></li>
                                            </ul>
                                        </div> 
                                    </li>
                                    <li class="nav-product-item show-pant"><a href="#" class="nav-product-link">Quần nam <i class="fa-solid fa-angle-right"></i></a>
                                        <div class="box-pant">
                                            <ul class="product-list">
                                                <li class="sub-product-item"><a href="#" class="product-link">Jean</a></li>
                                                <li class="sub-product-item"><a href="#" class="product-link">Kaki</a></li>
                                                <li class="sub-product-item"><a href="#" class="product-link">Âu</a></li>
                                                <li class="sub-product-item"><a href="#" class="product-link">Jogger</a></li>
                                            </ul>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        

                        <li class="navbar-item"><a href="#" class="navbar-item-link">bộ sưu tập</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-12">
                    <div class="box-search">
                        <form class="form-search">
                            <input placeholder="Tìm kiếm" type="text" name="inp-search" class="inp-search">
                            <button class="btn-search"><i style="margin: auto;" class="fa-solid fa-magnifying-glass"></i></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
            <div class="row">
                <div class="box-email w-100 ">
                    <form id="changePass" class="d-flex flex-column align-items-center justify-content-center">
                        <h4>ĐỔI MẬT KHẨU</h4>
                        <input placeholder="Nhập mật khẩu cũ" required type="password" name="old-pass">
                        <input placeholder="Nhập mật khẩu mới" required type="password" name="new-pass">
                        <input class="btn-form" name="btn-forgot" type="submit" value="Đổi mật khẩu">
                    </form>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer w-100">
        <div class="container">
            <div class="row">
                <div class="box-address d-flex w-100">
                    <ul class="address-list d-flex flex-column">
                        <h4 class="name-address">TP. Hồ Chí Minh</h4>
                        <li class="address-item d-flex flex-column">
                            <strong>Store 1:</strong>
                            <p>Tầng 3, Số 70 Lữ Gia, Phường 15, Quận 11, Thành phố Hồ Chí Minh</p>
                        </li>
                        <li class="address-item d-flex flex-column">
                            <strong>Store 1:</strong>
                            <p>Tầng 3, Số 70 Lữ Gia, Phường 15, Quận 11, Thành phố Hồ Chí Minh</p>
                        </li>
                        <li class="address-item d-flex flex-column">
                            <strong>Store 1:</strong>
                            <p>Tầng 3, Số 70 Lữ Gia, Phường 15, Quận 11, Thành phố Hồ Chí Minh</p>
                        </li>
                    </ul>
                    <ul class="address-list d-flex flex-column">
                        <h4 class="name-address">Hà Nội</h4>
                        <li class="address-item d-flex flex-column flex-column">
                            <strong>Store 1:</strong>
                            <p>Store 1: Tầng 3, Hà Thành Plaza, 102 Thái Thịnh, Phường Trung Liệt, Quận Đống Đa, Hà Nội</p>
                        </li>
                        <li class="address-item d-flex flex-column">
                            <strong>Store 1:</strong>
                            <p>Store 1: Tầng 3, Hà Thành Plaza, 102 Thái Thịnh, Phường Trung Liệt, Quận Đống Đa, Hà Nội</p>
                        </li>
                        <li class="address-item d-flex flex-column">
                            <strong>Store 1:</strong>
                            <p>Store 1: Tầng 3, Hà Thành Plaza, 102 Thái Thịnh, Phường Trung Liệt, Quận Đống Đa, Hà Nội</p>
                        </li>
                    </ul>
                    <ul class="contact-list">
                        <li class="contact-item">
                            <h6 class="contact-title">HỖ TRỢ (9:00 - 21:00)</h6>
                            <div class="box-contact d-flex">
                                <a href="tel:0825699866" class="contact-device"><i class="fa-solid fa-headphones"></i>0825699866</a>
                                <a href="mailto:luongdtx64@gmail.com" class="contact-device"><i class="fa-regular fa-envelope"></i>luongdtx64@gmail.com</a>
                            </div>
                        </li>
                        <li class="contact-item">
                            <h6 class="contact-title">THEO DÕI CHÚNG TÔI</h6>
                            <div class="box-contact d-flex">
                                <a href="https://www.facebook.com/luongdtx64" class="contact-device"><img src="http://t0458.store.nhanh.vn/tp/T0458/img/icon-fb.png" alt=""></a>
                                <a href="https://www.instagram.com/luongeto.dtx8/?fbclid=IwAR1nJnTetHDSwMPj6Z4reJKZZBjPuiKMorww_3iabii3z0RBcP0nCClLWDY" class="contact-device"><img src="http://t0458.store.nhanh.vn/tp/T0458/img/icon-insta.png" alt=""></a>
                            </div>
                        </li>
                        <li class="contact-item">
                            <h6 class="contact-title">PHƯƠNG THỨC THANH TOÁN</h6>
                            <div class="box-contact d-flex">
                                <a href="#" class="contact-device"><img src="http://t0458.store.nhanh.vn/tp/T0458/img/img-payment.png" alt=""></a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    <div class="modal-cart">
        <div class="modal-container-cart">
            <div class="container">
                <div class="modal-box">
                    <div class="close-btn">
                        <i class="fa-solid fa-xmark"></i>
                    </div>
                    <h3 class="title-modal">giỏ hàng</h3>
                    <div class="box-product-cart">
                        <p class="notify-cart">
                            Hiện không có sản phẩm nào
                        </p>
                        <ul class="product-cart-list">
                        </ul>
                    </div>
                    <span class="line"></span>
                    <div class="box-btn-cart d-flex justify-content-between">
                        <button id="continue-shopping" href="" class="btn-cart">Tiếp tục mua hàng</button>
                        <a href="#" class="btn-cart">Giỏ hàng</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="box-notify">
        
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script>
    function renderUser(){
    const username = document.querySelector('.name-user')
    const name = localStorage.getItem('user')
    username.innerText = name
}
function renderAvt(){
    let avt = document.querySelector('.avt')

    fetch('getAvt.php')
    .then(response=>{
        return response.json()
    })
    .then((data)=>{
        console.log(data)
        let avtSrc = data.map(function(avt){
            return avt.avt
        })
        avt.src=avtSrc.join()

    })
}

const renderCart = ()=>{
    let xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
            const products = JSON.parse(xhr.responseText);  
            let htmlCart = products.map(product=>{
                return `
                    <li class="product-item-${product.idsanpham} product-cart-item d-flex align-items-center justify-content-around" >
                        <img src="${product.hinhanh}" alt="sản phẩm" class="img-cart">
                        <div style="margin-top: 20px;" class="d-flex flex-column">
                            <span>Tên</span>
                            <p class="name-product-cart">${product.tensp}</p>
                        </div>
                        <div style="margin-top: 20px;" class="d-flex align-self-center flex-column">
                            <span>Giá</span>
                            <p class="cost-product-cart">${product.gia}</p>
                        </div>
                        <div style="margin-top: 20px;" class="d-flex flex-column">
                            <span>Số lượng</span>
                            <p class="amount-product-cart">x${product.soluong}</p>
                        </div>
                        <button id=${product.idsanpham} class="remove-product">Xoá</button>
                    
                    </li>
                `
                
            })
            const Notify = document.querySelector('.notify-cart')
            Notify.style.display = 'none'
            const proDuctList = document.querySelector('.product-cart-list')
            proDuctList.innerHTML = htmlCart.join()
            proDuctList.style.display = 'block'
            let childCount = proDuctList.childNodes.length;
            const btnDeletes = document.querySelectorAll('.remove-product')
            // var productID = document.querySelector(`.product-item-${idsanpham}`)
            btnDeletes.forEach((btnDelete)=>{
                btnDelete.addEventListener('click',(e)=>{
                    let idsanpham = e.target.id
                    const product = document.querySelector(`.product-item-${idsanpham}`)
                    $.ajax({
                        type: "POST",
                        url: "./deleteProduct.php",
                        data : {
                            idproduct:idsanpham
                        }
                    })
                    .done(function(response) {
                        // console.log(response)
                        if (product){
                            product.remove()
                            Toastify({
                                text: "Xoá sản phẩm thành công!", // Nội dung thông báo
                                duration: 3000, // Thời gian hiển thị (milisecond)
                                newWindow: true, // Mở ra một cửa sổ mới khi click vào thông báo
                                close: true, // Hiển thị nút đóng thông báo
                                gravity: "top", // Vị trí hiển thị của thông báo (top, bottom, left, right)
                                position: "center", // Vị trí chính xác của thông báo
                                backgroundColor: "linear-gradient(to right, #00b09b, #96c93d)", // Màu nền của thông báo
                                }).showToast();
                        }
                        
                    })
                    .fail(function(error){
                        console.log(error);
                    }) 
                })
            })
        }
    }
    xhr.open("GET", "getcart.php", true);
    xhr.send();
}
const handlerModal = ()=>{
    const btnOpenCart = document.querySelector('#open-modal')
    const modalCart = document.querySelector(".modal-cart")
    const btnClose = document.querySelector('.close-btn')
    const modalContainer = document.querySelector('.modal-container-cart')
    const btnContinueShopping = document.querySelector("#continue-shopping")
    btnOpenCart.addEventListener('click',function(){
        modalCart.style.display = 'block'
    })
    btnClose.addEventListener('click',function(){
        hideModalCart(modalCart)
    })
    modalCart.addEventListener('click',function(){
        hideModalCart(modalCart)
    })
    modalContainer.addEventListener('click',function(e){
        e.stopPropagation()
    })
    btnContinueShopping.onclick = function(){
        hideModalCart(modalCart)
    }
}
function hideModalCart(modal){
    modal.style.display = 'none'
}
var boxNotify = document.querySelector('.box-notify')
const hideNotify = ()=>{
    boxNotify.style.display = 'none'
}
const changePass = ()=>{
    const changePass = document.getElementById('changePass')
    changePass.addEventListener('submit', (e)=>{
        e.preventDefault()
        const oldPass = document.querySelector('input[name="old-pass"]').value
        const newPass = document.querySelector('input[name="new-pass"]').value
        const data = {
            oldPass: oldPass,
            newPass:newPass
        }
        fetch('changepass.php', {
            method: 'POST',
            body: JSON.stringify(data)
        })
        .then(response => response.text())
        .then(data => {
            if(data=='Mật khẩu hiện tại không đúng'){
                boxNotify.style.display = 'flex'
                    boxNotify.innerHTML = `
                    <div class="notify-content d-flex align-items-center justify-content-center flex-column">
                        <h4>Mật khẩu không đúng</h4>
                        <i class="error-color fa-sharp fa-solid fa-xmark"></i>
                        <span onclick = "hideNotify()">OK</span>
                    </div>
                    `
            }
            else if(data=='Mật khẩu đã được cập nhật thành công'){
                boxNotify.style.display = 'flex'
                    boxNotify.innerHTML = `
                    <div class="notify-content d-flex align-items-center justify-content-center flex-column">
                        <h4>Mật khẩu đã được thay đổi</h4>
                        <i class="fa-solid fa-check"></i>
                        <span onclick = "location.reload()">OK</span>
                    </div>
                    `
            }
            else{
                boxNotify.style.display = 'flex'
                    boxNotify.innerHTML = `
                    <div class="notify-content d-flex align-items-center justify-content-center flex-column">
                        <h4>Có lỗi xảy ra</h4>
                        <i class="error-color fa-sharp fa-solid fa-xmark"></i>
                        <span onclick = "hideNotify()">OK</span>
                    </div>
                    `
            }
        })
        .catch(error => {
            console.error('Lỗi:', error);
        });
    })
}
const run = ()=>{
    renderAvt()
    renderUser()
    renderCart()
    handlerModal()
    changePass()
}
run()
</script>
</html>